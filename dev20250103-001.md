# QUIC Core Package å¼€å‘æ–‡æ¡£

## å·¥ä½œå†…å®¹æ¦‚è¿°

### éœ€æ±‚èƒŒæ™¯

ä½œä¸ºQUICåè®®é‡æ„è®¡åˆ’çš„ç¬¬ä¸€ä¸ªåŒ…ï¼Œquic-coreæ˜¯æ•´ä¸ªQUICåè®®æ ˆçš„åŸºç¡€è®¾æ–½åŒ…ã€‚è´Ÿè´£æä¾›æ‰€æœ‰QUICåè®®çš„æ ¸å¿ƒå®šä¹‰ã€å¸¸é‡ã€æšä¸¾å’ŒåŸºç¡€æ•°æ®ç»“æ„ï¼Œä¸ºå…¶ä»–æ‰€æœ‰åŒ…æä¾›ç»Ÿä¸€çš„åŸºç¡€APIã€‚

### æ ¸å¿ƒåŠŸèƒ½

1. åè®®ç‰ˆæœ¬å¸¸é‡å®šä¹‰ï¼ˆQUIC Version 1: 0x00000001ï¼‰
2. é”™è¯¯ç æšä¸¾å®ç°ï¼ˆQuicError - æ¶µç›–RFC 9000å®šä¹‰çš„æ‰€æœ‰é”™è¯¯ç±»å‹ï¼‰
3. è¿æ¥çŠ¶æ€æšä¸¾ï¼ˆConnectionState - NEW, HANDSHAKING, CONNECTEDç­‰ï¼‰
4. å¸§ç±»å‹æšä¸¾ï¼ˆFrameType - PADDING, PING, ACK, STREAMç­‰ï¼‰
5. åŒ…ç±»å‹æšä¸¾ï¼ˆPacketType - INITIAL, HANDSHAKE, RETRYç­‰ï¼‰
6. å˜é•¿æ•´æ•°ç¼–è§£ç å™¨ï¼ˆæ”¯æŒ1-8å­—èŠ‚å˜é•¿æ•´æ•°ï¼‰
7. è¿æ¥IDç”Ÿæˆå™¨ï¼ˆæ”¯æŒ0-20å­—èŠ‚è¿æ¥IDï¼‰
8. åŸºç¡€å¼‚å¸¸ç±»ï¼ˆQuicExceptionåŠå…¶å­ç±»ï¼‰
9. åè®®å¸¸é‡å®šä¹‰ï¼ˆé»˜è®¤è¶…æ—¶ã€æœ€å¤§å€¼ç­‰ï¼‰
10. é€šç”¨å·¥å…·ç±»å’Œè¾…åŠ©å‡½æ•°

### æŠ€æœ¯èŒƒå›´

- PHP 8.1+ ç°ä»£è¯­æ³•ç‰¹æ€§
- PSR-4 è‡ªåŠ¨åŠ è½½è§„èŒƒ
- PHPUnit 10+ å•å…ƒæµ‹è¯•
- PHPStan Level 9 é™æ€åˆ†æ
- ä¸¥æ ¼ç±»å‹å£°æ˜å’Œæšä¸¾æ”¯æŒ

## ä»»åŠ¡æ‹†åˆ†ä¸è¿›åº¦è®¡åˆ’

| ä»»åŠ¡é˜¶æ®µ | å…·ä½“ä»»åŠ¡é¡¹ | ä¼˜å…ˆçº§ | é¢„ä¼°è€—æ—¶ | è¿›åº¦çŠ¶æ€ï¼ˆâ³/ğŸ”„/âœ…ï¼‰ | è´£ä»»äºº |
|---------|-----------|--------|----------|-------------------|--------|
| åŸºç¡€è®¾æ–½ | 1. åˆ›å»ºåŒ…ç›®å½•ç»“æ„å’Œcomposer.json | P0 | 1h | â³ | AIå·¥å…· |
|         | 2. è®¾ç½®PHPUnitå’ŒPHPStané…ç½® | P0 | 1h | â³ | AIå·¥å…· |
|         | 3. åˆ›å»ºåŸºç¡€å‘½åç©ºé—´å’Œè‡ªåŠ¨åŠ è½½ | P0 | 0.5h | â³ | AIå·¥å…· |
| æ ¸å¿ƒæšä¸¾ | 1. å®ç°QuicErroré”™è¯¯ç æšä¸¾ | P0 | 2h | â³ | AIå·¥å…· |
|         | 2. å®ç°ConnectionStateè¿æ¥çŠ¶æ€æšä¸¾ | P0 | 1h | â³ | AIå·¥å…· |
|         | 3. å®ç°FrameTypeå¸§ç±»å‹æšä¸¾ | P0 | 2h | â³ | AIå·¥å…· |
|         | 4. å®ç°PacketTypeåŒ…ç±»å‹æšä¸¾ | P0 | 1h | â³ | AIå·¥å…· |
| å·¥å…·ç±» | 1. å®ç°VariableIntegerå˜é•¿æ•´æ•°ç¼–è§£ç  | P0 | 4h | â³ | AIå·¥å…· |
|        | 2. å®ç°ConnectionIdè¿æ¥IDç”Ÿæˆå™¨ | P0 | 2h | â³ | AIå·¥å…· |
|        | 3. å®ç°Constantsåè®®å¸¸é‡ç±» | P0 | 1h | â³ | AIå·¥å…· |
| å¼‚å¸¸å¤„ç† | 1. å®ç°QuicExceptionåŸºç¡€å¼‚å¸¸ç±» | P1 | 2h | â³ | AIå·¥å…· |
|          | 2. å®ç°å…·ä½“å¼‚å¸¸å­ç±» | P1 | 3h | â³ | AIå·¥å…· |
| æµ‹è¯•å®ç° | 1. ç¼–å†™æ‰€æœ‰æšä¸¾çš„å•å…ƒæµ‹è¯• | P0 | 4h | â³ | AIå·¥å…· |
|          | 2. ç¼–å†™VariableIntegerçš„æµ‹è¯•ç”¨ä¾‹ | P0 | 3h | â³ | AIå·¥å…· |
|          | 3. ç¼–å†™ConnectionIdçš„æµ‹è¯•ç”¨ä¾‹ | P0 | 2h | â³ | AIå·¥å…· |
|          | 4. ç¼–å†™å¼‚å¸¸ç±»çš„æµ‹è¯•ç”¨ä¾‹ | P1 | 2h | â³ | AIå·¥å…· |
| æ–‡æ¡£å®Œå–„ | 1. ç¼–å†™APIæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹ | P1 | 3h | â³ | AIå·¥å…· |
|          | 2. ç¼–å†™RFCå¯¹åº”å…³ç³»æ–‡æ¡£ | P1 | 2h | â³ | AIå·¥å…· |

## éªŒæ”¶æ¡ä»¶æ¸…å•

### åŠŸèƒ½éªŒæ”¶

- æ‰€æœ‰PHPæ–‡ä»¶éƒ½åº”é€šè¿‡phpstan Level 9æ ¡éªŒï¼š`./vendor/bin/phpstan analyse packages/quic-core/src -l 9`
- æ‰€æœ‰æšä¸¾ç±»å‹éƒ½æœ‰å®Œæ•´çš„æ–¹æ³•å®ç°å’Œæ–‡æ¡£æ³¨é‡Š
- VariableIntegerèƒ½æ­£ç¡®ç¼–è§£ç 1-8å­—èŠ‚çš„å˜é•¿æ•´æ•°
- ConnectionIdèƒ½ç”Ÿæˆç¬¦åˆRFCè§„èŒƒçš„è¿æ¥IDï¼ˆ0-20å­—èŠ‚ï¼‰
- æ‰€æœ‰å¸¸é‡å€¼ä¸RFC 9000è§„èŒƒå®Œå…¨ä¸€è‡´
- å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„æ¸…æ™°ï¼Œé”™è¯¯ä¿¡æ¯è¯¦ç»†

### æµ‹è¯•éªŒæ”¶

- å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°95%ä»¥ä¸Š
- æ‰€æœ‰è¾¹ç•Œæ¡ä»¶éƒ½æœ‰å¯¹åº”æµ‹è¯•ç”¨ä¾‹
- æ€§èƒ½æµ‹è¯•ï¼šVariableIntegerç¼–è§£ç æ€§èƒ½ > 1M ops/sec
- å†…å­˜æµ‹è¯•ï¼šæ‰€æœ‰æ“ä½œæ— å†…å­˜æ³„æ¼

### æ–‡æ¡£éªŒæ”¶

- README.mdåŒ…å«å®Œæ•´çš„å®‰è£…å’Œä½¿ç”¨è¯´æ˜
- æ‰€æœ‰å…¬å…±APIéƒ½æœ‰è¯¦ç»†çš„PHPDocæ³¨é‡Š
- æä¾›å®Œæ•´çš„ä»£ç ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

### åˆè§„éªŒæ”¶

- ä¸¥æ ¼éµå¾ªPSR-4ã€PSR-12ä»£ç è§„èŒƒ
- æ‰€æœ‰ç±»å’Œæ–¹æ³•éƒ½æœ‰æ­£ç¡®çš„ç±»å‹å£°æ˜
- é€šè¿‡PHP 8.1+å…¼å®¹æ€§æµ‹è¯•
- ç¬¦åˆé¡¹ç›®çš„ç¼–ç æ ‡å‡†å’Œå®‰å…¨è¦æ±‚

## ç‰¹æ®Šå¤‡æ³¨è¯´æ˜

### æŠ€æœ¯éš¾ç‚¹

1. **å˜é•¿æ•´æ•°å®ç°**ï¼šéœ€è¦ä¸¥æ ¼æŒ‰ç…§RFC 9000 Section 16å®ç°ï¼Œæ”¯æŒ1/2/4/8å­—èŠ‚ç¼–ç 
2. **æšä¸¾æ–¹æ³•æ‰©å±•**ï¼šä¸ºæ‰€æœ‰æšä¸¾æ·»åŠ ä¾¿åˆ©æ–¹æ³•ï¼Œå¦‚isError()ã€canTransition()ç­‰
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ ¸å¿ƒç¼–è§£ç å‡½æ•°éœ€è¦é«˜æ€§èƒ½ï¼Œè€ƒè™‘ä½¿ç”¨ä½è¿ç®—ä¼˜åŒ–

### ä¾èµ–å…³ç³»

- **æ— å¤–éƒ¨ä¾èµ–**ï¼šä½œä¸ºåŸºç¡€åŒ…ï¼Œä¸ä¾èµ–ä»»ä½•å…¶ä»–QUICåŒ…
- **PHPæ‰©å±•ä¾èµ–**ï¼šéœ€è¦mbstringæ‰©å±•ç”¨äºå­—èŠ‚æ“ä½œ
- **å¼€å‘ä¾èµ–**ï¼šPHPUnitã€PHPStanã€Composer

### è¾“å‡ºæ¥å£

```php
namespace Tourze\QUIC\Core;

// æ ¸å¿ƒå¸¸é‡
class Constants {
    public const VERSION_1 = 0x00000001;
    public const MAX_PACKET_SIZE = 65535;
    public const DEFAULT_IDLE_TIMEOUT = 30;
}

// é”™è¯¯ç æšä¸¾
enum QuicError: int {
    case NO_ERROR = 0x0;
    case INTERNAL_ERROR = 0x1;
    case CONNECTION_REFUSED = 0x2;
    // ... å…¶ä»–é”™è¯¯ç 
    
    public function isConnectionError(): bool;
    public function isApplicationError(): bool;
}

// è¿æ¥çŠ¶æ€æšä¸¾
enum ConnectionState: string {
    case NEW = 'new';
    case HANDSHAKING = 'handshaking';
    case CONNECTED = 'connected';
    case CLOSING = 'closing';
    case CLOSED = 'closed';
    
    public function canSendData(): bool;
    public function canReceiveData(): bool;
}

// å¸§ç±»å‹æšä¸¾
enum FrameType: int {
    case PADDING = 0x00;
    case PING = 0x01;
    case ACK = 0x02;
    // ... å…¶ä»–å¸§ç±»å‹
    
    public function isFlowControlled(): bool;
    public function needsReliableDelivery(): bool;
}

// åŒ…ç±»å‹æšä¸¾
enum PacketType: int {
    case INITIAL = 0x00;
    case ZERO_RTT = 0x01;
    case HANDSHAKE = 0x02;
    case RETRY = 0x03;
    
    public function isLongHeader(): bool;
    public function isEncrypted(): bool;
}

// å˜é•¿æ•´æ•°ç¼–è§£ç å™¨
class VariableInteger {
    public static function encode(int $value): string;
    public static function decode(string $data, int $offset = 0): array;
    public static function getLength(int $value): int;
}

// è¿æ¥IDç”Ÿæˆå™¨
class ConnectionId {
    public static function generate(int $length = 8): string;
    public static function validate(string $connectionId): bool;
    public static function random(): string;
}

// åŸºç¡€å¼‚å¸¸
class QuicException extends \Exception {
    public function __construct(string $message, QuicError $errorCode);
    public function getQuicError(): QuicError;
}
```

## æ‰§è¡Œæµç¨‹è¯´æ˜

1. **ç¯å¢ƒå‡†å¤‡**ï¼šç¡®ä¿PHP 8.1+ç¯å¢ƒï¼Œå®‰è£…Composerä¾èµ–
2. **åŸºç¡€æ¶æ„**ï¼šåˆ›å»ºç›®å½•ç»“æ„ï¼Œé…ç½®è‡ªåŠ¨åŠ è½½å’Œæµ‹è¯•æ¡†æ¶
3. **æ ¸å¿ƒå®ç°**ï¼šæŒ‰ä¼˜å…ˆçº§å®ç°æšä¸¾ã€å·¥å…·ç±»ã€å¼‚å¸¸å¤„ç†
4. **æµ‹è¯•éªŒè¯**ï¼šç¼–å†™å…¨é¢çš„å•å…ƒæµ‹è¯•ï¼Œç¡®ä¿åŠŸèƒ½æ­£ç¡®æ€§
5. **æ–‡æ¡£å®Œå–„**ï¼šç¼–å†™è¯¦ç»†çš„APIæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
6. **é›†æˆéªŒè¯**ï¼šä¸å…¶ä»–åŒ…çš„é›†æˆæµ‹è¯•ï¼ˆåœ¨åç»­åŒ…å¼€å‘æ—¶è¿›è¡Œï¼‰

### å…³é”®é‡Œç¨‹ç¢‘

- **Week 1 End**ï¼šå®Œæˆæ‰€æœ‰æ ¸å¿ƒæšä¸¾å’ŒåŸºç¡€å·¥å…·ç±»
- **Week 2 End**ï¼šå®Œæˆæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å’Œæ–‡æ¡£ï¼Œè¾¾åˆ°å‘å¸ƒæ ‡å‡†

---
*æ­¤æ–‡æ¡£å°†åœ¨å¼€å‘è¿‡ç¨‹ä¸­æŒç»­æ›´æ–°ï¼Œè®°å½•é‡è¦çš„è®¾è®¡å†³ç­–å’Œå®ç°ç»†èŠ‚*
